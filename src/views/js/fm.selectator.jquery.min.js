!function(O){"use strict";O.selectator=function(e,t){var n={prefix:"selectator_",height:"auto",useDimmer:!1,useSearch:!0,showAllOptionsOnFocus:!1,selectFirstOptionOnSearch:!0,keepOpen:!1,submitCallback:function(){},load:null,delay:0,minSearchLength:0,valueField:"value",textField:"text",searchFields:["value","text"],placeholder:"",render:{selected_item:function(e,t){var n="";return void 0!==e.left&&(n+='<div class="'+a.options.prefix+'selected_item_left"><img src="'+t(e.left)+'"></div>'),void 0!==e.right&&(n+='<div class="'+a.options.prefix+'selected_item_right">'+t(e.right)+"</div>"),n+='<div class="'+a.options.prefix+'selected_item_title">'+(void 0!==e.text?t(e.text):"")+"</div>",void 0!==e.subtitle&&(n+='<div class="'+a.options.prefix+'selected_item_subtitle">'+t(e.subtitle)+"</div>"),n+='<div class="'+a.options.prefix+'selected_item_remove">X</div>'},option:function(e,t){var n="";return void 0!==e.left&&(n+='<div class="'+a.options.prefix+'option_left"><img src="'+t(e.left)+'"></div>'),void 0!==e.right&&(n+='<div class="'+a.options.prefix+'option_right">'+t(e.right)+"</div>"),n+='<div class="'+a.options.prefix+'option_title">'+(void 0!==e.text?t(e.text):"")+"</div>",void 0!==e.subtitle&&(n+='<div class="'+a.options.prefix+'option_subtitle">'+t(e.subtitle)+"</div>"),n}},labels:{search:"Search..."}},a=this;a.options={},a.$source_element=O(e),a.$container_element=null,a.$selecteditems_element=null,a.$input_element=null,a.$textlength_element=null,a.$options_element=null,a.usefilterResults=!0;var r=void 0===a.$source_element.attr("multiple"),p=!r,i=!1,c=!0,o=null,s=8,l=9,d=13,u=16,m=27,h=37,_=38,f=39,v=40;a.init=function(){var e;a.options=O.extend(!0,{},n,t),O.each(a.$source_element.data(),function(e,t){"selectator"==e.substring(0,10)&&(a.options[e.substring(10,11).toLowerCase()+e.substring(11)]=t)}),a.options.searchFields="string"==typeof a.options.searchFields?a.options.searchFields.split(" "):a.options.searchFields,a.$source_element.find("option").each(function(){O(this).data("value",this.value),O(this).data("text",this.text)}),i=null!==a.options.load,a.options.useDimmer&&0===O("#"+a.options.prefix+"dimmer").length&&((e=O(document.createElement("div"))).attr("id",a.options.prefix+"dimmer"),e.hide(),O(document.body).prepend(e)),a.$source_element.addClass("selectator"),a.$source_element.attr("placeholder")&&(a.options.placeholder=a.$source_element.attr("placeholder")),a.$container_element=O(document.createElement("div")),void 0!==a.$source_element.attr("id")&&a.$container_element.attr("id",a.options.prefix+a.$source_element.attr("id")),a.$container_element.addClass(a.options.prefix+"element "+(p?"multiple ":"single ")+"options-hidden"),a.options.useSearch||a.$container_element.addClass("disable_search"),a.$container_element.css({width:a.$source_element.css("width"),minHeight:a.$source_element.css("height"),padding:a.$source_element.css("padding"),"flex-grow":a.$source_element.css("flex-grow"),position:"relative"}),"element"===a.options.height&&a.$container_element.css({height:a.$source_element.outerHeight()+"px"}),a.$textlength_element=O(document.createElement("span")),a.$textlength_element.addClass(a.options.prefix+"textlength"),a.$textlength_element.css({position:"absolute",visibility:"hidden"}),a.$container_element.append(a.$textlength_element),a.$selecteditems_element=O(document.createElement("div")),a.$selecteditems_element.addClass(a.options.prefix+"selected_items"),a.$container_element.append(a.$selecteditems_element),a.$input_element=O(document.createElement("input")),a.$input_element.addClass(a.options.prefix+"input"),a.$input_element.attr("tabindex",a.$source_element.attr("tabindex")),a.options.useSearch?r?a.$input_element.attr("placeholder",a.options.labels.search):(""!=a.options.placeholder&&a.$input_element.attr("placeholder",a.options.placeholder),a.$input_element.width(20)):(a.$input_element.attr("readonly",!0),a.$input_element.css({width:"0px",height:"0px",overflow:"hidden",border:0,padding:0,position:"absolute"})),a.$input_element.attr("autocomplete","false"),a.$container_element.append(a.$input_element),a.$options_element=O(document.createElement("ul")),a.$options_element.addClass(a.options.prefix+"options"),a.$container_element.append(a.$options_element),a.$source_element.after(a.$container_element),a.$source_element.hide(),"undefined"!=typeof Scrollator&&a.$options_element.scrollator({zIndex:1001,customClass:"ease_preventOverlay"}),a.$source_element.change(function(){g()}),a.$container_element.on("focus",function(){a.$input_element.focus(),a.$input_element.trigger("focus")}),a.$container_element.on("mousedown",function(e){e.preventDefault(),a.$input_element.focus(),a.$input_element.trigger("focus"),a.$input_element[0].setSelectionRange?a.$input_element[0].setSelectionRange(a.$input_element.val().length,a.$input_element.val().length):a.$input_element[0].createTextRange&&((e=a.$input_element[0].createTextRange()).collapse(!0),e.moveEnd("character",a.$input_element.val().length),e.moveStart("character",a.$input_element.val().length),e.select())}),a.$container_element.on("click",function(){a.$input_element.focus(),a.$input_element.trigger("focus")}),a.$container_element.on("dblclick",function(){a.$input_element.select(),a.$input_element.trigger("focus")}),a.$input_element.on("keydown",function(e){var t,n=null,i=null;switch(e.keyCode||e.which){case _:e.preventDefault(),y(),0!==(n=a.$options_element.find(".active")).length?(i=n.prevUntil("."+a.options.prefix+"option:visible").add(n).first().prev("."+a.options.prefix+"option:visible"),n.removeClass("active"),i.addClass("active")):a.$options_element.find("."+a.options.prefix+"option").filter(":visible").last().addClass("active"),S();break;case v:e.preventDefault(),y(),0!==(n=a.$options_element.find(".active")).length?(i=n.nextUntil("."+a.options.prefix+"option:visible").add(n).last().next("."+a.options.prefix+"option:visible"),n.removeClass("active"),i.addClass("active")):a.$options_element.find("."+a.options.prefix+"option").filter(":visible").first().addClass("active"),S();break;case m:e.preventDefault();break;case d:e.preventDefault(),0!==(n=a.$options_element.find(".active")).length?F():""!==a.$input_element.val()&&a.options.submitCallback(a.$input_element.val()),$();break;case s:a.options.useSearch?(""===a.$input_element.val()&&p&&a.$source_element.find("option:selected").length&&((t=a.$source_element.find("option:selected").last()[0]).removeAttribute("selected"),t.selected=!1,a.$source_element.trigger("change"),g()),$()):e.preventDefault();break;default:$()}}),a.$input_element.on("keyup",function(e){e.preventDefault(),e.stopPropagation();e=e.which;switch(e){case m:k();break;case d:a.options.keepOpen||k();break;case h:case f:case _:case v:case l:case u:break;default:C()}!a.$container_element.hasClass("options-hidden")||e!==h&&e!==f&&e!==_&&e!==v||y(),$()}),a.$input_element.on("focus",function(){a.$container_element.addClass("focused"),!r&&!a.options.showAllOptionsOnFocus&&a.options.useSearch||y()}),a.$input_element.on("blur",function(){a.$container_element.removeClass("focused"),k()}),a.$container_element.on("mouseup","."+a.options.prefix+"selected_item_remove",function(){var e=O(this).closest("."+a.options.prefix+"selected_item").data("source_item_element");e.removeAttribute("selected"),e.selected=!1,r&&a.$source_element.find('[value=""]').length&&((e=a.$source_element.find('[value=""]')[0]).setAttribute("selected",""),e.selected=!0),a.$source_element.trigger("change"),w(a.usefilterResults),x(),g()}),a.$container_element.on("mouseover","."+a.options.prefix+"option",function(){a.$options_element.find(".active").removeClass("active"),O(this).addClass("active")}),a.$container_element.on("mousedown","."+a.options.prefix+"option",function(e){e.preventDefault(),e.stopPropagation()}),a.$container_element.on("mouseup","."+a.options.prefix+"option",function(){F()}),a.$container_element.on("click","."+a.options.prefix+"option",function(e){e.stopPropagation()}),a.options.$source_element=a.$source_element,a.options.$container_element=a.$container_element,a.options.$selecteditems_element=a.$selecteditems_element,a.options.$input_element=a.$input_element,a.options.$textlength_element=a.$textlength_element,a.options.$options_element=a.$options_element,x(),g(),$()};var $=function(){var e;p&&(a.$textlength_element.text(""===a.$input_element.val()&&""!==a.options.placeholder?a.options.placeholder:a.$input_element.val()),e=a.$textlength_element.width()>a.$container_element.width()-30?a.$container_element.width()-30:a.$textlength_element.width()+30,a.$input_element.css({width:e+"px"}))},g=function(){a.$selecteditems_element.empty(),a.$source_element.find("option").each(function(){var e,t,n=O(this);this.selected&&((e=O(document.createElement("div"))).data("source_item_element",this),e.addClass(a.options.prefix+"selected_item"),e.addClass(a.options.prefix+"value_"+n.val().replace(/\W/g,"")),void 0!==n.attr("class")&&e.addClass(n.attr("class")),t={value:this.value,text:this.text},O.each(this.attributes,function(){this.specified&&(t[this.name.replace("data-","")]=this.value)}),O.extend(t,O(this).data("item_data")),e.append(a.options.render.selected_item(t,D)),!r||""!=t[a.options.valueField]&&void 0!==t[a.options.valueField]&&0!==a.$source_element.find('[value=""]').length||e.find("."+a.options.prefix+"selected_item_remove").remove(),a.$selecteditems_element.append(e))}),r&&(""==a.options.placeholder||""!==a.$source_element.val()&&null!==a.$source_element.val()?a.$selecteditems_element.find("."+a.options.prefix+"placeholder").remove():(a.$selecteditems_element.empty(),a.$selecteditems_element.append('<div class="'+a.options.prefix+'placeholder">'+a.options.placeholder+"</div>")))},x=function(){a.$options_element.empty();var n=[];a.$source_element.children().each(function(){var e,t;"optgroup"===O(this).prop("tagName").toLowerCase()?0!==(e=O(this)).children("option").length&&(t=[],e.children("option").each(function(){t.push({type:"option",text:O(this).html(),element:this})}),n.push({type:"group",text:e.attr("label"),options:t,element:e})):n.push({type:"option",text:O(this).html(),element:this})}),O(n).each(function(){var e;"group"===this.type?((e=O(document.createElement("li"))).addClass(a.options.prefix+"group"),void 0!==O(this.element).attr("class")&&e.addClass(O(this.element).attr("class")),e.html(O(this.element).attr("label")),a.$options_element.append(e),O(this.options).each(function(){var e=b.call(this.element,!0);a.$options_element.append(e)})):(e=b.call(this.element,!1),a.$options_element.append(e))}),w(a.usefilterResults)},b=function(e){var t=O(document.createElement("li"));t.data("source_option_element",this),t.addClass(a.options.prefix+"option"),t.addClass(a.options.prefix+"value_"+O(this).val().replace(/\W/g,"")),e&&t.addClass(a.options.prefix+"group_option"),this.selected&&t.addClass("active"),void 0!==O(this).attr("class")&&t.addClass(O(this).attr("class"));var n={value:this.value,text:this.text};return O.each(this.attributes,function(){this.specified&&(n[this.name.replace("data-","")]=this.value)}),O.extend(n,O(this).data("item_data")),p&&this.selected&&t.hide(),t.append(a.options.render.option(n,D)),t},C=function(){clearTimeout(o),o=setTimeout(function(){a.$container_element.addClass("loading"),i?a.options.load(a.$input_element.val(),function(e,t){if(a.usefilterResults=void 0!==t&&t,a.$source_element.children("option").not(":selected").not('[value=""]').remove(),void 0!==e){var n=[];if(O.each(a.$source_element.children("option:selected"),function(e,t){n.push(t.value)}),r&&0===a.$source_element.find('[value=""]').length&&a.$source_element.prepend(O('<option value="">&nbsp;</option>')),a.$input_element.val().replace(/\s/g,"").length>=a.options.minSearchLength)for(var i=0;i<e.length;i++){var o,s=e[i];-1===O.inArray(s[a.options.valueField]+"",n)&&(o=O('<option value="'+s[a.options.valueField]+'">'+s[a.options.textField]+"</option>"),a.$source_element.append(o),o.data("item_data",s))}}x(),a.$container_element.removeClass("loading"),w(a.usefilterResults)}):(a.$container_element.removeClass("loading"),w(a.usefilterResults))},a.options.delay)},w=function(o){o=void 0!==o&&o;var s=a.$input_element.val().replace(/\s/g,"").length<a.options.minSearchLength;c=!1;var l=a.$input_element.val().toLowerCase();a.$options_element.find("."+a.options.prefix+"option").each(function(){var e=O(this),t=e.data("source_option_element"),n=O(t),i=!1;O.each(a.options.searchFields,function(e,t){if(void 0!==n.data(t)&&-1!==n.data(t).toString().toLowerCase().indexOf(l))return!(i=!0)}),!o&&!t.selected||o&&(!t.selected||r)&&(a.options.useSearch&&(s||i||""===n.val())||!a.options.useSearch)?(e.show(),c=c||!0):e.hide()}),a.$options_element.find("."+a.options.prefix+"group").each(function(){var e=O(this),t=!1;e.nextUntil("."+a.options.prefix+"group").each(function(){if("none"!=O(this).css("display"))return!(t=!0)}),t?e.show():e.hide()}),y(),p&&(a.$options_element.find(".active").removeClass("active"),s||a.$options_element.find("."+a.options.prefix+"option").filter(":visible").first().addClass("active"))},y=function(){!a.$input_element.is(":focus")||!c&&!r||a.$options_element.is(":empty")&&!a.options.useSearch?k():(a.$container_element.removeClass("options-hidden").addClass("options-visible"),a.options.useDimmer&&O("#"+a.options.prefix+"dimmer").show(),setTimeout(function(){a.$options_element.css("top",a.$container_element.outerHeight()+(p?0:a.$input_element.outerHeight())-1+"px"),"undefined"!=typeof Scrollator&&a.$options_element.data("scrollator").show()},1),S())},k=function(){a.$container_element.removeClass("options-visible").addClass("options-hidden"),"undefined"!=typeof Scrollator&&a.$options_element.data("scrollator").hide(),a.options.useDimmer&&O("#"+a.options.prefix+"dimmer").hide()},S=function(){var e=a.$options_element.find("."+a.options.prefix+"option.active");0<e.length&&a.$options_element.scrollTop(a.$options_element.scrollTop()+e.position().top-a.$options_element.height()/2+e.height()/2)},F=function(){var e=a.$options_element.find(".active");e.data("source_option_element").setAttribute("selected",""),e.data("source_option_element").selected=!0,a.$source_element.trigger("change"),a.options.keepOpen||a.$input_element.val(""),w(a.usefilterResults),g(),$(),i&&!a.options.keepOpen&&(a.$source_element.children("option").not(":selected").not('[value=""]').remove(),x(),k()),a.options.keepOpen||k()},D=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};a.refresh=function(){g()},a.destroy=function(){a.$container_element.remove(),O.removeData(e,"selectator"),a.$source_element.show(),0===O("."+a.options.prefix+"element").length&&O("#"+a.options.prefix+"dimmer").remove()},a.init()},O.fn.selectator=function(e){var n=void 0!==e?e:{};return this.each(function(){var e,t=O(this);"object"==typeof n?void 0===t.data("selectator")&&(e=new O.selectator(this,n),t.data("selectator",e)):t.data("selectator")[n]?t.data("selectator")[n].apply(this,Array.prototype.slice.call(arguments,1)):O.error("Method "+n+" does not exist in $.selectator")})}}(jQuery),$(function(){"use strict";$(".selectator").each(function(){var e=$(this),n={};$.each(e.data(),function(e,t){"selectator"==e.substring(0,10)&&(n[e.substring(10,11).toLowerCase()+e.substring(11)]=t)}),e.selectator(n)})});